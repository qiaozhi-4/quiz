<style lang="scss">
	.page {
		background: #1F1146;

		.scroll-view {

			height: 100vh;
		}

		.head {
			display: grid;
			place-content: end start;
		}

		.main {

			.v1 {
				justify-content: center;
				align-items: center;
				padding: 10px;
				gap: 8px;


				.nickname {
					font-family: 'Inter';
					font-style: normal;
					font-weight: 700;
					font-size: 20px;
					line-height: 24px;
				}
			}

			.v2 {
				justify-content: center;
				align-items: center;
				padding: 10px;
				gap: 10px;

				.statistics {
					justify-content: center;
					align-items: center;
					padding: 6px 26px;
					gap: 6px;

					width: 110px;
					height: 32px;

					background: rgba(255, 255, 255, 0.05);
					border-radius: 15px;

					.text1 {
						font-family: 'Inter';
						font-style: normal;
						font-weight: 800;
						font-size: 20px;
						line-height: 24px;
					}

					.text2 {
						font-family: 'Inter';
						font-style: normal;
						font-weight: 500;
						font-size: 12px;
						line-height: 15px;
						color: rgba(255, 255, 255, 0.3);
					}
				}
			}

			.v3 {
				background: #5830C7;
				border-radius: 15px 15px 0px 0px;

				.task {
					display: grid;
					grid-template-columns: 1fr 1fr;
					margin: 0 15px 15px 15px;

					padding: 10px 13px;
					gap: 10px;

					background: #46269E;
					border-radius: 0px 0px 15px 15px;

					.t1 {
						/* 10ç­”0é—® */
						font-family: 'Inter';
						font-style: normal;
						font-weight: 800;
						font-size: 20px;
						line-height: 24px;

						color: #FFFFFF;
					}

					.t2 {
						/* æœ¬å‘¨è¿ç»­å›ç­”10é¢˜ */
						font-family: 'Inter';
						font-style: normal;
						font-weight: 700;
						font-size: 12px;
						line-height: 15px;

						color: rgba(255, 255, 255, 0.5);
					}

					.b1 {
						grid-column: 2;
						grid-row: 1 / span 2;
						place-self: center end;

						padding: 6px 15px;

						/* æ·¡ç´« ç²‰è‰²æ¸å˜ */
						background: linear-gradient(90deg, #5830C7 0%, #BE53FF 100%);
						border-radius: 30px;

						/* é¢†å–å¥–åŠ± */
						font-family: 'Inter';
						font-style: normal;
						font-weight: 700;
						font-size: 12px;
						line-height: 19px;
						text-align: center;

						color: #FFFFFF;
					}
				}

				.table {

					.table-tags {
						position: sticky;
						/* å½“æ»šåŠ¨åˆ°è·ç¦»é¡¶éƒ¨ 0 åƒç´ æ—¶ç²˜ä½ */
						top: 0;
						/* ç¡®ä¿ç²˜æ€§å…ƒç´ åœ¨å…¶ä»–å…ƒç´ ä¸Šæ–¹ */
						z-index: 1;
						padding-top: 0;
						transition: padding-top 0.2s linear;
						background: #5830C7;

						justify-content: space-between;

						.tag {
							width: 100%;
							padding: 9px 0px;
							justify-content: center;
							align-items: center;

							/* äº²å¯†æ’è¡Œ */
							font-family: 'Inter';
							font-style: normal;
							font-weight: 700;
							font-size: 16px;
							line-height: 19px;
							text-align: center;

							background: #1F1146;
							color: rgba(255, 255, 255, 0.3);
						}

						.left {
							border-radius: 20px 0 0px 0px;
						}

						.right {
							border-radius: 0 20px 0px 0px;
						}

						.active {
							position: relative;
							color: #fff;
							background: #5830C7;
							border-radius: 0px 0px 20px 20px;
						}

						.active::after {
							left: 0;
							background: radial-gradient(circle at 100% 0%, transparent 20px, #1F1146 0);
						}

						.active::before {
							right: 0;
							background: radial-gradient(circle at 0% 0%, transparent 20px, #1F1146 0);
						}

						.active::after,
						.active::before {
							content: '';
							position: absolute;
							bottom: 0;
							width: 20px;
							height: 20px;
							/* è®¾ç½®è¿‡æ¸¡æ•ˆæœ */
							animation: moveAndFadeIn 0.5s ease;
						}

						@keyframes moveAndFadeIn {
							0% {
								height: 0;
							}

							100% {
								height: 20px;
							}
						}
					}

					.table-content {
						background: #1F1146;

						justify-content: start;
						align-items: center;

						padding-top: 10px;

						.my-ranking {
							box-sizing: border-box;
							align-items: center;
							padding: 20px;
							gap: 10px;
							width: 100%;
							border-bottom: 1px solid #7756EC;

							.nickname {
								flex-grow: 1;
								/* ç½‘å */
								font-family: 'Inter';
								font-style: normal;
								font-weight: 700;
								font-size: 20px;
								line-height: 24px;

								color: #E2E2E2;
							}

							.score-grou {
								box-sizing: border-box;
								justify-content: center;
								align-items: center;
								padding: 1px 7px;
								gap: 2px;

								background: linear-gradient(180deg, #AF48FF 0%, #5C42FF 100%);
								border: 1px solid #C958FF;
								border-radius: 15px;

								.score {
									font-family: 'Inter';
									font-style: normal;
									font-weight: 800;
									font-size: 16px;
									line-height: 19px;

									color: #FFFFFF;
								}

								.t1 {
									// text-align: center;
									padding: 0;
									/* åˆ† */
									font-family: 'Inter';
									font-style: normal;
									font-weight: 800;
									font-size: 12px;
									line-height: 15px;


									color: #FFFFFF;
								}
							}

							.ranking {
								/* ä½äºç¬¬2å */
								font-family: 'Inter';
								font-style: normal;
								font-weight: 800;
								font-size: 16px;
								line-height: 19px;

								color: #FFFFFF;
							}
						}

						.table-null-text {
							/* æ‚¨çš„äº²å¯†æ’è¡Œç©ºç©ºå¦‚ä¹Ÿ ğŸŒŸå¿«å»é‚€è¯·æœ‹å‹å§ï¼ */
							font-family: 'Inter';
							font-style: normal;
							font-weight: 700;
							font-size: 32px;
							line-height: 39px;
							text-align: center;

							color: #FFFFFF;
						}

						.t1 {
							padding-top: 50px;
						}

						.table-null-button {
							margin-top: 20px;
							box-sizing: border-box;
							display: flex;
							flex-direction: row;
							justify-content: center;
							align-items: center;
							padding: 9px 0px;

							width: 244px;
							height: 52px;

							/* æ·¡ç´« ç²‰è‰²æ¸å˜ */
							background: linear-gradient(90deg, #5830C7 0%, #BE53FF 100%);
							border: 1px solid rgba(255, 255, 255, 0.3);
							box-shadow: 0px 0px 14px 4px rgba(255, 255, 255, 0.25);
							border-radius: 30px;

							font-family: 'Inter';
							font-style: normal;
							font-weight: 700;
							font-size: 28px;
							line-height: 34px;

							color: #FFFFFF;
						}

						.table-item {
							display: grid;
							grid-template-columns: auto auto 1fr auto auto;
							align-items: center;
							width: 100%;
							height: 54px;
							padding: 0 15px;

							.ranking {
								padding-right: 15px;

								font-family: 'Inter';
								font-style: normal;
								font-weight: 700;
								font-size: 16px;
								line-height: 19px;
							}

							.nickname {
								justify-self: start;
								padding-left: 5px;

								font-family: 'Inter';
								font-style: normal;
								font-weight: 700;
								font-size: 16px;
								line-height: 19px;
							}

							.score {
								font-family: 'Inter';
								font-style: normal;
								font-weight: 800;
								font-size: 20px;
								line-height: 24px;
								text-align: center;

								color: #A729E2;
							}

							.svg {
								justify-self: end;

								padding-left: 15px;
							}

							.no1 {
								background: linear-gradient(251.44deg, #F5A022 19.28%, #FFCA10 80.72%);
								background-clip: text;
								-webkit-background-clip: text;
								color: transparent;
								text-shadow: 0px 0px 20px #FFAD55;
							}

							.no2 {
								background: linear-gradient(180deg, #B3B3B3 0%, #F5F5F5 100%);
								background-clip: text;
								-webkit-background-clip: text;
								color: transparent;
								text-shadow: 0px 0px 20px #F5F5F5;
							}

							.no3 {
								background: linear-gradient(180deg, #B37F43 0%, #D0995A 100%);
								background-clip: text;
								-webkit-background-clip: text;
								color: transparent;
								text-shadow: 0px 0px 20px #D0995A;
							}
						}
					}

					.test-info {
						background: #1F1146;
						gap: 20px;
						padding: 0 20px;

						.class {
							gap: 10px;

							.name1 {
								font-family: 'Inter';
								font-style: normal;
								font-weight: 400;
								font-size: 14px;
								line-height: 17px;
								/* identical to box height */

								color: #FFFFFF;
							}

							.item1 {
								position: relative;

								padding: 11px 13px;
								gap: 3px;

								background: rgba(255, 255, 255, 0.1);
								border-radius: 15px;

								.question-title {
									gap: 3px;

									.svg {
										width: 10px;
										height: 10px;
									}

									.title {
										font-family: 'Inter';
										font-style: normal;
										font-weight: 500;
										font-size: 12px;
										line-height: 15px;

										color: #FFFFFF;

										opacity: 0.7;
									}
								}

								.question-info {
									justify-content: space-between;
									align-items: center;
									gap: 3px;
									padding-left: 10px;

									.option {
										font-family: 'Inter';
										font-style: normal;
										font-weight: 700;
										font-size: 16px;
										line-height: 19px;
										letter-spacing: -0.04em;

										color: #FFFFFF;
									}

									.input-value {
										font-family: 'Inter';
										font-style: normal;
										font-weight: 500;
										font-size: 12px;
										line-height: 15px;
										/* identical to box height */
										letter-spacing: -0.04em;

										color: rgba(255, 255, 255, 0.75);
									}
								}

								.svg {
									position: absolute;
									right: -11px;
									top: -11px;
								}
							}

							.item1-1 {
								position: relative;
								padding: 8px 11px;
								gap: 20px;

								background: rgba(255, 255, 255, 0.07);
								border-radius: 15px;

								.user-info {
									justify-content: center;
									align-items: center;
									gap: 2px;

									.nickname {
										font-family: 'Inter';
										font-style: normal;
										font-weight: 600;
										font-size: 12px;
										line-height: 15px;
										text-align: center;

										color: #FFFFFF;
									}
								}

								.topic {
									position: relative;
									gap: 4px;
									justify-content: center;

									.svg {
										position: absolute;
										left: -10px;
										top: 10px;
									}

									.title {
										font-family: 'Inter';
										font-style: normal;
										font-weight: 300;
										font-size: 12px;
										line-height: 15px;

										color: #FFFFFF;
									}

									.answer {
										font-family: 'Inter';
										font-style: normal;
										font-weight: 900;
										font-size: 16px;
										line-height: 19px;

										color: #FFFFFF;
									}
								}

								.svg {
									position: absolute;
									right: -11px;
									top: -11px;
								}
							}

							.add {
								justify-content: center;
								gap: 4px;
								position: relative;

								box-sizing: border-box;
								padding: 13px 30px;
								border: 1px dashed #FFFFFF;
								border-radius: 15px;

								background: #2F1969;

								.t1 {
									font-family: 'Inter';
									font-style: normal;
									font-weight: 900;
									font-size: 16px;
									line-height: 19px;

									color: #FFFFFF;
								}

								.t2 {
									font-family: 'Inter';
									font-style: normal;
									font-weight: 300;
									font-size: 12px;
									line-height: 15px;

									color: rgba(255, 255, 255, 0.3);
								}

								.svg {
									position: absolute;
									right: -11px;
									top: -11px;
								}
							}

							.items {
								position: relative;
								right: 20px;
								width: 100vw;
								background: rgba(255, 255, 255, 0.07);


								.item2 {
									display: grid;
									grid-template-columns: 1fr auto;
									gap: 10px;
									align-items: center;
									padding: 10px 20px;

									.title {
										font-family: 'Inter';
										font-style: normal;
										font-weight: 400;
										font-size: 14px;
										line-height: 17px;
										color: #FFFFFF;
									}

									.option {
										font-family: 'Inter';
										font-style: normal;
										font-weight: 600;
										font-size: 14px;
										line-height: 17px;

										color: #A143FF;
									}

									.input-value {
										font-family: 'Inter';
										font-style: normal;
										font-weight: 500;
										font-size: 12px;
										line-height: 15px;

										color: rgba(255, 255, 255, 0.4);
									}
								}
							}

							.t1 {
								/* æŸ¥çœ‹å…¨éƒ¨ */
								font-family: 'Inter';
								font-style: normal;
								font-weight: 600;
								font-size: 12px;
								line-height: 15px;

								color: #A729E2;

							}
						}
					}



					.table-record {
						background: #1F1146;
						gap: 10px;

						.input-wrap {
							align-items: center;
							gap: 5px;
							margin: 10px;
							background: rgba(255, 255, 255, 0.1);
							padding: 7px 18px;
							border-radius: 30px;

							.input {
								width: 100%;
								font-family: 'Inter';
								font-style: normal;
								font-weight: 700;
								font-size: 16px;
								line-height: 19px;

								color: #FFFFFF;
							}

							.input-placeholder {
								font-family: 'Inter';
								font-style: normal;
								font-weight: 400;
								font-size: 16px;
								line-height: 19px;

								color: rgba(255, 255, 255, 0.3);
							}
						}

						.test-paper-my {
							margin: 0 12.5px;
							padding: 11px 13px;
							gap: 12px;

							background: #5830C7;
							border-radius: 15px;

							.v1 {
								padding: 0;
								align-items: center;
								justify-content: space-between;

								.title {
									font-family: 'Inter';
									font-style: normal;
									font-weight: 700;
									font-size: 16px;
									line-height: 19px;
									letter-spacing: -0.04em;

									color: #FFFFFF;
								}

								.count {
									font-family: 'Inter';
									font-style: normal;
									font-weight: 500;
									font-size: 12px;
									line-height: 15px;
									/* identical to box height */
									letter-spacing: -0.04em;

									color: rgba(255, 255, 255, 0.7);

								}
							}

							.v2 {
								padding: 0;
								gap: 10px;
								align-items: center;
								justify-content: flex-end;

								.extra {
									flex-grow: 1;
								}

								.button {
									justify-content: center;
									align-items: center;
									padding: 5px 15px;
									gap: 10px;

									background: rgba(255, 255, 255, 0.3);
									backdrop-filter: blur(25px);
									border-radius: 30px;

									font-family: 'Inter';
									font-style: normal;
									font-weight: 700;
									font-size: 12px;
									line-height: 15px;
									/* identical to box height */

									color: #FFFFFF;

								}
							}
						}
					}
				}
			}
		}

		.test-paper-friend {
			margin: 0 12.5px;
			padding: 11px 13px;
			gap: 12px;

			background: #5830C7;
			border-radius: 15px;

			.v1 {
				padding: 0;
				align-items: center;
				justify-content: space-between;

				.title {
					flex-grow: 1;
					font-family: 'Inter';
					font-style: normal;
					font-weight: 700;
					font-size: 16px;
					line-height: 19px;
					letter-spacing: -0.04em;

					color: #FFFFFF;
				}

				.error,
				.correct {
					width: 15px;
					height: 15px;
					border-radius: 50%;
				}

				.correct {
					background: linear-gradient(180deg, #A4FF48 0%, #CFF33C 100%);
					box-shadow: 4px 0px 4px rgba(112, 184, 39, 0.25);
				}

				.error {
					background: linear-gradient(180deg, #FF4848 0%, #F3733C 100%);
					box-shadow: 4px 0px 4px rgba(231, 40, 28, 0.25);
				}

				.count {
					font-family: 'Inter';
					font-style: normal;
					font-weight: 600;
					font-size: 16px;
					line-height: 19px;

					color: #FFFFFF;
				}
			}

			.progress-warp {
				width: 100%;
				height: 9px;

				background: rgba(255, 255, 255, 0.1);
				border-radius: 15px;

				.progress {

					height: 9px;
					background: #FFFFFF;
					border-radius: 15px;

				}
			}

			.v2 {
				padding: 0;
				gap: 10px;
				align-items: center;
				justify-content: flex-end;

				.button {
					justify-content: center;
					align-items: center;
					padding: 5px 15px;
					gap: 10px;

					background: rgba(255, 255, 255, 0.3);
					backdrop-filter: blur(25px);
					border-radius: 30px;

					font-family: 'Inter';
					font-style: normal;
					font-weight: 700;
					font-size: 12px;
					line-height: 15px;
					/* identical to box height */

					color: #FFFFFF;

				}
			}
		}

		.footer {
			width: 100vw;
			position: absolute;
			bottom: 0;
			/* å½“æ»šåŠ¨åˆ°è·ç¦»é¡¶éƒ¨ 0 åƒç´ æ—¶ç²˜ä½ */
			z-index: 1;
			/* ç¡®ä¿ç²˜æ€§å…ƒç´ åœ¨å…¶ä»–å…ƒç´ ä¸Šæ–¹ */
			/* å‡ºé¢˜æŒ‰é’® */

			box-sizing: border-box;
			flex-direction: column;
			align-items: center;
			padding: 30px 31px;

			background: #1F1146;
			border-top: 1px solid rgba(255, 255, 255, 0.3);
			border-radius: 15px 15px 0px 0px;

			.b1 {
				flex-direction: column;
				align-items: center;
				padding: 10px;

				width: 299px;

				box-sizing: border-box;

				background: linear-gradient(90deg, #8163FB 0%, #AE2EDA 23.19%, #A627E1 89.69%);
				border-radius: 30px;

				font-family: 'Inter';
				font-style: normal;
				font-weight: 700;
				font-size: 24px;
				line-height: 29px;

				color: #FFFFFF;
			}
		}
	}
</style>

<template>
	<!-- æç¤ºæ¶ˆæ¯ -->
	<q-alert ref="refAlert"></q-alert>
	<view class="page">
		<scroll-view class="scroll-view" scroll-y="true" @scroll="onScroll" :scroll-top="scrollTop"
			scroll-with-animation>
			<q-nav-bar v-if="!isFriendHome" fixed>
				<template #left>
					<q-svg icon="è®¾ç½®" size="32" />
				</template>
			</q-nav-bar>
			<q-nav-bar v-else fixed></q-nav-bar>
			<view class="main flex-column">
				<view class="v1 flex-column">
					<q-avatar :isChooseAvatar="!isFriendHome" :src="userInfo?.avatarUrl" size="69" borderWidth="3" />
					<view class="nickname">{{userInfo?.nickname}}</view>
				</view>
				<view class="v2">
					<view class="statistics">
						<text class="text1">{{questionBank?.length}}</text>
						<text class="text2">å‡ºé¢˜</text>
					</view>
					<view class="statistics">
						<text class="text1">{{testBank?.length}}</text>
						<text class="text2">ç­”é¢˜</text>
					</view>
					<view class="statistics">
						<text class="text1">{{intimateFriends?.length}}</text>
						<text class="text2">å¯†å‹</text>
					</view>
				</view>
				<view class="v3 flex-column">
					<view v-if="isFriendHome" style="height: 30px;"></view>
					<view v-else class="task">
						<text class="t1">{{prop[0]?.number}}åˆ†</text>
						<text class="t2">æœ¬å‘¨è¿ç»­å›ç­”10é¢˜</text>
						<button class="b1" @click="clickTask">é¢†å–å¥–åŠ±</button>
					</view>
					<view class="table flex-column">
						<view class="table-tags" :style="{paddingTop:`${tagPaddingTop}px`}">
							<view class="tag"
								:class="{active:activeTag==index, left:index==activeTag+1, right:index==activeTag-1 }"
								v-for="(tag,index) in tags" :key="index" @click="onTag(index)">
								{{tag}}
							</view>
						</view>
						<view v-show="activeTag==0" class="table-content flex-column">
							<template v-if="intimateRanking?.length!=0">
								<view v-if="myRanking?.totalScore" class="my-ranking">
									<view class="nickname">{{myRanking?.nickname}}</view>
									<view class="score-grou">
										<text class="score">{{myRanking?.totalScore}}</text>
										<text class="t1">åˆ†</text>
									</view>
									<view class="ranking">ä½äºç¬¬{{myRanking?.ranking}}å</view>
								</view>
								<view v-for="(friend, index) in intimateRanking" :key="index" class="table-item"
									style="position: relative;" @click="goFriendHome(friend.userId)">
									<view
										style="position: absolute;top: 0;right: 0;width: 76vw; height: 1px;background-color: rgba(121, 109, 255, 0.5);">
									</view>
									<view class="ranking" :class="`no${index+1}`">{{index+1}}</view>
									<q-avatar :src="friend.avatarUrl" size="42" />
									<view class="nickname" :class="`no${index+1}`">{{friend.nickname}}</view>
									<view class="score" :class="`no${index+1}`">{{friend.totalScore}}</view>
									<q-svg class="svg" icon="ä¸ªäººä¸»é¡µ-æ’è¡Œ-è½¬åˆ°å¥½å‹" size="22" />
								</view>
							</template>
							<template v-else>
								<text class="table-null-text t1">æ‚¨çš„äº²å¯†æ’è¡Œç©ºç©ºå¦‚ä¹Ÿ</text>
								<text class="table-null-text t2">ğŸŒŸå¿«å»é‚€è¯·æœ‹å‹å§ï¼</text>
								<!-- <button class="table-null-button b1">è®©æœ‹å‹æµ‹æµ‹ï¼</button> -->
							</template>
						</view>
						<view v-show="activeTag==1" class="test-info flex-column">
							<template v-if="true">
								åˆ¶ä½œä¸­
							</template>
							<template v-else>
								<view v-for="(e ,index) in testInfo" :key="index" class="class flex-column">
									<template v-if="index < 2">
										<view class="name1">{{e?.name}}</view>
										<template v-for="(item,i) in e.items" :key="i">
											<view v-if="item?.title && index == 0" class="item1 flex-column">
												<view class="question-title">
													<q-svg icon="å·¦åŒå¼•å·" size="10" />
													<view class="title text-overflow">{{item?.title}}</view>
												</view>
												<view class="question-info">
													<view class="option text-overflow">{{item?.select}}</view>
													<view class="input-value text-overflow">{{item?.input}}</view>
												</view>
												<q-svg class="svg" icon="ä¸ªäººä¸»é¡µ-æµ‹è¯•ä¿¡æ¯-åˆ é™¤" size="22"
													@click="remove(index,i)"></q-svg>
											</view>

											<view v-if="item?.title && index == 1" class="item1-1">
												<view class="user-info flex-column">
													<q-avatar :src="item?.avatarUrl" size="41"></q-avatar>
													<view class="nickname">{{item?.nickname}}</view>
												</view>
												<view class="topic flex-column">
													<q-svg class="svg" icon="å·¦åŒå¼•å·" size="10" />
													<text class="title text-overflow">{{item?.title}}</text>
													<text class="answer text-overflow">{{item?.select}}</text>
												</view>
												<q-svg class="svg" icon="ä¸ªäººä¸»é¡µ-æµ‹è¯•ä¿¡æ¯-åˆ é™¤" size="22"
													@click="remove(index,i)"></q-svg>
											</view>
										</template>
										<view class="add flex-column" @click="add(index)">
											<text class="t1">{{e?.extra?.t1}}</text>
											<text class="t2">{{e?.extra?.t2}}</text>
											<q-svg class="svg" icon="ä¸ªäººä¸»é¡µ-æµ‹è¯•ä¿¡æ¯-æ·»åŠ " size="22"></q-svg>
										</view>
									</template>
									<template v-else>
										<view class="name1">{{e.name}}</view>
										<view class="items flex-column">
											<template v-for="(item,i) in e.items" :key="i">
												<view v-if="i < 4 || e.spread" class="item2">
													<view class="title text-overflow">{{item?.title}}</view>
													<view class="option text-overflow">{{item?.select}}</view>
													<view class="input-value text-overflow">{{item?.input}}</view>
												</view>
											</template>
										</view>
										<text v-if="e.spread" class="t1" @click="hidden(index)">æ”¶èµ·</text>
										<text v-else class="t1" @click="showAll(index)">æŸ¥çœ‹å…¨éƒ¨</text>
									</template>
								</view>
							</template>
						</view>
						<view v-show="activeTag==2" class="table-record flex-column">
							<view class="input-wrap">
								<q-svg class="svg" icon="æœç´¢" size="14.5" />
								<input class="input" placeholder-class="input-placeholder" placeholder="æœç´¢"
									:adjust-position="false" @input="onInput" @blur="onBlur" :value="input" />
							</view>
							<template v-if="isFriendHome">
								<template v-for="(question,index) in questionBank" :key="index">
									<view :style="question?.isAnswer ? '': 'background-color: #352858;'"
										class="test-paper-friend flex-column">
										<view class="v1">
											<text class="title">{{userInfo?.nickname}}çš„{{question?.order}}å·æµ‹è¯•</text>
											<text class="correct"></text>
											<text class="num">{{question?.isAnswer ? question?.score/10 : 0}}</text>
											<text class="error"></text>
											<text class="num">{{question?.isAnswer ? 10-question?.score/10 : 0}}</text>
										</view>
										<view class="progress-warp">
											<view :style="`width: ${question?.score}%;`" class="progress">
											</view>
										</view>
										<view class="v2">
											<template v-if="question?.isAnswer">
												<button class="button"
													@click="onParticulars(question?.paperId,question?.selects)">æŸ¥çœ‹è¯¦æƒ…</button>
												<button v-show="question?.score!=100" class="button flex-row"
													@click="goTest(question?.paperId)">
													<q-svg icon="å¤æ´»å®çŸ³" size="16" />ä½¿ç”¨å¤æ´»å®çŸ³å†æµ‹ä¸€æ¬¡ï¼
												</button>
											</template>
											<button v-else class="button"
												@click="goTest(question?.paperId)">å¼€å§‹æµ‹è¯•</button>
										</view>
									</view>
								</template>
							</template>
							<template v-else>
								<view v-for="(question,index) in questionBank" :key="index"
									class="test-paper-my flex-column">
									<view class="v1">
										<text class="title">{{userInfo?.nickname}}çš„{{question?.order}}å·æµ‹è¯•</text>
										<text class="count">{{question?.answersTotal}}ä¸ªæœ‹å‹æµ‹è¿‡</text>
									</view>
									<view class="v2">
										<view class="extra">
											<q-bubble>
												<reference>
													<button class="button"
														@click="onRemorPafer(question?.paperId,index)">åˆ é™¤</button>
												</reference>
											</q-bubble>
										</view>
										<button class="button"
											@click="onParticulars(question?.paperId,null)">æŸ¥çœ‹è¯¦æƒ…</button>
										<button :data-paperId="question?.paperId" class="button"
											open-type="share">åˆ†äº«ç»™æœ‹å‹</button>
									</view>
								</view>
							</template>
						</view>
						<view style="min-height: 160px; background-color: #1F1146;"></view>
					</view>

				</view>
			</view>
		</scroll-view>
		<view v-if="isFriendHome" v-show="activeTag!=2" class="footer">
			<button class="b1" @click="activeTag = 2">æµ‹æµ‹çœ‹æˆ‘å’ŒTaçš„é»˜å¥‘ï¼</button>
		</view>
		<view v-else class="footer">
			<button class="b1" @click="goSetTest">å»å‡ºé¢˜</button>
		</view>
	</view>
</template>

<script lang="ts" setup>
	import { ref } from 'vue'
	import { onLoad, onShareAppMessage } from '@dcloudio/uni-app'
	import { getPaperList, removePaper } from '../../utils/api/paper';
	import { getIntimateFriends, getIntimateRanking, getUser } from '../../utils/api/user';
	import { getAnswersList } from '../../utils/api/answers';
	import { updateUser } from '../../utils/api/wxUser';

	/** æç¤ºæ¶ˆæ¯ref */
	const refAlert = ref()
	/** è·å–ç™»å½•ä¿¡æ¯ */
	const userInfo = ref<Quiz.UserInfo>()
	/** è·å–é“å…·ä¿¡æ¯ */
	const prop = ref<any[]>()
	/** å¤´éƒ¨æ ·å¼ */
	const headStyle = getApp().globalData.headStyle
	/** å¤´éƒ¨é«˜åº¦ */
	const headHeight = getApp().globalData.headHeight
	/** ä¸»ä½“é«˜åº¦ */
	const mainHeight = getApp().globalData.mainHeight
	/** æ ‡ç­¾ */
	const tags = ref(['äº²å¯†æ’è¡Œ', 'é—®ç­”å±•ç¤º', 'æˆ‘çš„é¢˜åº“'])
	/** å½“å‰æ¿€æ´»çš„æ ‡ç­¾ */
	const activeTag = ref(0)
	/** æ»šåŠ¨æ¡ä½ç½® */
	const scrollTop = ref(0)
	/** æ ‡ç­¾è§¦å‘ç²˜æ€§å®šä½çš„ä¸Šè¾¹è· */
	const tagPaddingTop = ref(0)
	/** äº²å¯†æ’è¡Œæ¦œæ•°æ® */
	const intimateRanking = ref<Quiz.UserInfo[]>()
	/** å¯†å‹æ•°æ® */
	const intimateFriends = ref<Quiz.UserInfo[]>()
	/** æµ‹è¯•ä¿¡æ¯æ•°æ® */
	const testInfo = ref([
		{
			name: 'å…³é”®é¢˜',
			items: [{
				title: 'ä½ æœ€å–œæ¬¢åœ¨å‘¨æœ«åšä»€ä¹ˆï¼Ÿ',
				select: 'åœ¨å®¶è¿›è¡Œä¸ªäººæ´»åŠ¨',
				input: 'åƒé¥­ç¡è§‰æ¸¸æˆä»£ç '
			}, {
				title: 'ä½ æ›´å–œæ¬¢å“ªç§ç±»å‹çš„ç”µå½±ï¼Ÿ',
				select: 'ç™½å¼€æ°´',
			},],
			extra: {
				t1: 'é€‰æ‹©ä¸€é“é¢˜',
				t2: 'å±•ç¤ºä½ çš„ç­”æ¡ˆ',
			}
		},
		{
			name: 'æœ‹å‹çš„çœ‹æ³•',
			items: [],
			extra: {
				t1: 'é€‰æ‹©1æ¡æœ‹å‹çš„çœ‹æ³•',
				t2: 'å±•ç¤ºå›ç­”',
			}
		},
		{
			name: 'åŸºç¡€é¢˜',
			spread: false,
			items: [{
				title: 'ä½ æœ€å–œæ¬¢åœ¨å‘¨æœ«åšä»€ä¹ˆï¼Ÿ',
				select: 'åœ¨å®¶è¿›è¡Œä¸ªäººæ´»åŠ¨',
				input: 'åƒé¥­ç¡è§‰æ¸¸æˆä»£ç '
			}, {
				title: 'ä½ æ›´å–œæ¬¢å“ªç§ç±»å‹çš„ç”µå½±ï¼Ÿ',
				select: 'ç™½å¼€æ°´',
			}, {
				title: 'ä½ æœ€å–œæ¬¢åœ¨å‘¨æœ«åšä»€ä¹ˆï¼Ÿ',
				select: 'åœ¨å®¶è¿›è¡Œä¸ªäººæ´»åŠ¨',
				input: 'åƒé¥­ç¡è§‰æ¸¸æˆä»£ç '
			}, {
				title: 'ä½ æ›´å–œæ¬¢å“ªç§ç±»å‹çš„ç”µå½±ï¼Ÿ',
				select: 'ç™½å¼€æ°´',
			},]
		},
		{
			name: 'è¿›é˜¶é¢˜',
			spread: false,
			items: [{
				title: 'ä½ æœ€å–œæ¬¢åœ¨å‘¨æœ«åšä»€ä¹ˆï¼Ÿ',
				select: 'åœ¨å®¶è¿›è¡Œä¸ªäººæ´»åŠ¨',
				input: 'åƒé¥­ç¡è§‰æ¸¸æˆä»£ç '
			}, {
				title: 'ä½ æ›´å–œæ¬¢å“ªç§ç±»å‹çš„ç”µå½±ï¼Ÿ',
				select: 'ç™½å¼€æ°´',
			}, {
				title: 'ä½ æœ€å–œæ¬¢åœ¨å‘¨æœ«åšä»€ä¹ˆï¼Ÿ',
				select: 'åœ¨å®¶è¿›è¡Œä¸ªäººæ´»åŠ¨',
				input: 'åƒé¥­ç¡è§‰æ¸¸æˆä»£ç '
			}, {
				title: 'ä½ æ›´å–œæ¬¢å“ªç§ç±»å‹çš„ç”µå½±ï¼Ÿ',
				select: 'ç™½å¼€æ°´',
			},]
		},
		{
			name: 'æ ¸å¿ƒé¢˜',
			spread: false,
			items: [{
				title: 'ä½ æœ€å–œæ¬¢åœ¨å‘¨æœ«åšä»€ä¹ˆï¼Ÿ',
				select: 'åœ¨å®¶è¿›è¡Œä¸ªäººæ´»åŠ¨',
				input: 'åƒé¥­ç¡è§‰æ¸¸æˆä»£ç '
			}, {
				title: 'ä½ æ›´å–œæ¬¢å“ªç§ç±»å‹çš„ç”µå½±ï¼Ÿ',
				select: 'ç™½å¼€æ°´',
			}, {
				title: 'ä½ æœ€å–œæ¬¢åœ¨å‘¨æœ«åšä»€ä¹ˆï¼Ÿ',
				select: 'åœ¨å®¶è¿›è¡Œä¸ªäººæ´»åŠ¨',
				input: 'åƒé¥­ç¡è§‰æ¸¸æˆä»£ç '
			}, {
				title: 'ä½ æ›´å–œæ¬¢å“ªç§ç±»å‹çš„ç”µå½±ï¼Ÿ',
				select: 'ç™½å¼€æ°´',
			},]
		},
	])
	/** æœç´¢æ¡†è¾“å…¥ */
	const input = ref('')
	/** é¢˜åº“æ•°æ® */
	const questionBank = ref([])
	/** æµ‹è¯•è®°å½• */
	const testBank = ref([])
	/** æ˜¯å¦æ—¶æœ‹å‹ä¸»é¡µ */
	const isFriendHome = ref<boolean>(false)
	/** æˆ‘åœ¨æ’è¡Œæ¦œçš„æ’å */
	const myRanking = ref()
	/** å…³é—­å½“å‰é¡µé¢,è¿”å›ä¸Šä¸€ä¸ªé¡µé¢ */
	function handlerReverseBack() {
		uni.navigateBack({
			delta: 1
		});
	}
	/** ç‚¹å‡»æœ‹å‹è§¦å‘ */
	function goFriendHome(id) {
		if (id == getApp().globalData.userInfo.userId) {
			refAlert.value.show({ msg: 'è‡ªå·±éƒ½ä¸è®¤è¯†äº†å—?' })
			return
		}
		uni.navigateTo({
			// url: `/pages/friend-home/friend-home?id=${id}`
			url: `/pages/home/home?userId=${id}&isFriendHome=${true}`
		});
	}
	/** ç‚¹å‡»é¢†å–å¥–åŠ±è§¦å‘,è·³è½¬åˆ°ä»»åŠ¡é¡µé¢ */
	function clickTask() {
		uni.navigateTo({
			url: `/pages/task/task`
		});
	}
	/** é¡µé¢æ»šåŠ¨è§¦å‘ */
	function onScroll(e) {
		if (e.detail.scrollTop > 230) {
			tagPaddingTop.value = headHeight
		} else {
			tagPaddingTop.value = 0
		}
	}
	/** ç‚¹å‡»tagè§¦å‘ */
	function onTag(index) {
		scrollTop.value = 0
		scrollTop.value = 325
		activeTag.value = index
	}
	/** åˆ é™¤å±•ç¤ºå…³é”®é¢˜ */
	function remove(infoIindex, itemIndx) {
		delete testInfo.value[infoIindex].items[itemIndx]
	}
	/** æ·»åŠ å±•ç¤ºå…³é”®é¢˜ */
	function add(infoIindex) {
		console.log('æ·»åŠ å±•ç¤ºå…³é”®é¢˜:', infoIindex);
		if (testInfo.value[infoIindex].name == "å…³é”®é¢˜") {
			uni.navigateTo({
				url: `/pages/select-topic/select-topic?index=${infoIindex}`
			});
		} else if (testInfo.value[infoIindex].name == "æœ‹å‹çš„çœ‹æ³•") {
			uni.navigateTo({
				url: `/pages/select-friend-view/select-friend-view?index=${infoIindex}`
			});
		}
	}
	/** å±•ç¤ºå…¨éƒ¨æµ‹è¯•ä¿¡æ¯ */
	function showAll(infoIindex) {
		if (testInfo.value[infoIindex].items.length < 5) {
			for (let i = 0; i < 5; i++) {
				testInfo.value[infoIindex].items.push({
					title: 'ä½ æœ€å–œæ¬¢åœ¨å‘¨æœ«åšä»€ä¹ˆï¼Ÿ',
					select: 'åœ¨å®¶è¿›è¡Œä¸ªäººæ´»åŠ¨',
					input: 'åƒé¥­ç¡è§‰æ¸¸æˆä»£ç '
				})
			}
		}
		testInfo.value[infoIindex].spread = true
	}
	/** æ”¶èµ·å…¨éƒ¨æµ‹è¯•ä¿¡æ¯ */
	function hidden(infoIindex) {
		testInfo.value[infoIindex].spread = false
	}
	/** é”®ç›˜è¾“å…¥è§¦å‘ */
	function onInput(e : any) {
		input.value = e.detail.value
	}
	/** é”®ç›˜å¤±å»ç„¦ç‚¹è§¦å‘ */
	function onBlur(e : any) {
		input.value = e.detail.value
	}
	/** åˆ é™¤è¯•å· */
	function onRemorPafer(paperId : number, index : number) {
		removePaper(paperId).then(res => {
			if (res.data)
				questionBank.value.splice(index, 1)
		})
	}
	/** è·³è½¬é¢˜åº“çš„è¯•å·è¯¦æƒ… */
	function onParticulars(paperId : number, selects : string) {
		if (isFriendHome.value) {
			uni.navigateTo({
				url: `/pages/question-particulars/question-particulars?isFriendHome=${true}&paperId=${paperId}&selects=${selects}&userId=${userInfo.value.userId}`
			});

		}
		else {
			uni.navigateTo({
				url: `/pages/question-particulars/question-particulars?isFriendHome=${false}&paperId=${paperId}&selects=${selects}&userId=${userInfo.value.userId}`
			});
		}
	}
	/** ä»æœ‹å‹é¢˜åº“å¼€å§‹ç­”é¢˜ */
	function goTest(paperId : number) {
		uni.redirectTo({
			url: `/pages/start-test/start-test?isAnswer=true&paperId=${paperId}&userId=${userInfo.value.userId}`
		});
	}
	/** åˆ†äº«è¯•å· */
	onShareAppMessage((res) => {
		if (res.from === 'button') {// æ¥è‡ªé¡µé¢å†…åˆ†äº«æŒ‰é’®
			return {
				title: 'æˆ‘ä»¬ä¹‹é—´æœ‰å¤šäº²å¯†ï¼Ÿ',
				path: `/pages/start-test/start-test?isAnswer=true&paperId=${res.target.dataset.paperid}&userId=${userInfo.value.userId}`,
				imageUrl: '/static/img/å°è½¬å‘çª—.png'
			}
		}
		return {
			title: 'è¿™æµ‹è¯•',
			path: '/pages/start-test/start-test?isAnswer=true',
			imageUrl: '/static/img/å°è½¬å‘çª—.png'
		}
	})
	/** è·³è½¬åˆ°å‡ºé¢˜é¡µ */
	function goSetTest() {
		uni.navigateTo({
			url: `/pages/start-test/start-test?isAnswer=false`
		});
	}
	onLoad((option) => {
		if (option.topicId) {
			activeTag.value = 1
			console.log('è¿™æ˜¯ä»é€‰æ‹©é¢˜ç›®æ¥çš„å‚æ•°', option);
			testInfo.value[0].items.push({
				title: `é¢˜ç›®${option.topicId}`,
				select: 'åç»­ä»æ•°æ®æŸ¥è¯¢',
				input: 'åƒé¥­ç¡è§‰æ¸¸æˆä»£ç '
			})
		} else if (option.friendId) {
			activeTag.value = 1
			console.log('è¿™æ˜¯ä»é€‰æ‹©æœ‹å‹çœ‹æ³•æ¥çš„å‚æ•°', option);
			testInfo.value[1].items.push({
				nickname: `ç”¨æˆ·${option.friendId}`,
				avatarUrl: '',
				title: 'åç»­ä»æ•°æ®æŸ¥è¯¢',
				select: 'å–œæ¬¢ä¸å†·ä¸çƒ­ä¸é›¨ä¸æ™´ï¼Œé˜´å¤©æœ€å¥½',
			})
		}

		/* å¦‚æœæ˜¯æœ‹å‹ä¸»é¡µ */
		if (option.isFriendHome == 'true') {
			isFriendHome.value = true
			getUser(option.userId).then(res => {
				userInfo.value = res.data
				getIntimateRanking(userInfo.value.userId).then(res => {
					intimateRanking.value = res.data
					let userId = getApp().globalData.userInfo.userId
					for (var i = 0; i < intimateRanking.value.length; i++) {
						if (userId == intimateRanking.value[i].userId) {
							myRanking.value = intimateRanking.value[i]
							myRanking.value.ranking = i + 1
							break;
						}
					}
				})
				getIntimateFriends(userInfo.value.userId).then(res => {
					intimateFriends.value = res.data
				})
				getPaperList(userInfo.value.userId).then((res) => {
					questionBank.value = res.data
					const intervalId = setInterval(() => {
						if (testBank.value.length > 0) {
							questionBank.value.forEach(el => {
								let temp = testBank.value.filter(e => el?.paperId == e.paperId)[0]
								if (temp) {
									el.score = temp.score
									el.selects = temp.selects
									el.isAnswer = true
								}
							})
							clearInterval(intervalId); // åœæ­¢å®šæ—¶å™¨
						}
					}, 2000); // 2000æ¯«ç§’ï¼Œå³2ç§’
				})
			})
		} else {
			userInfo.value = getApp().globalData.userInfo
			prop.value = getApp().globalData.props
			getIntimateRanking(userInfo.value.userId).then(res => {
				intimateRanking.value = res.data
			})
			getIntimateFriends(userInfo.value.userId).then(res => {
				intimateFriends.value = res.data
			})
			getPaperList(userInfo.value.userId).then((res) => {
				questionBank.value = res.data
			})
		}
		getAnswersList(getApp().globalData.userInfo.userId).then(res => {
			testBank.value = res.data
		})
	})
</script>